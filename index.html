<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connect Four ‚Äì German Modal Verbs</title>
<meta name="theme-color" content="#0f172a">
<style>
:root{
  --bg:#0f172a;
  --panel:#111827ee;
  --muted:#94a3b8;
  --text:#e5e7eb;
  --accent:#22d3ee;
  --red:#ef4444;
  --yellow:#f59e0b;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0b1224,#0f172a 40%);color:var(--text);font:16px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
.app{max-width:1100px;margin:24px auto;padding:16px}
header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap}
.title{font-size:clamp(20px,2.5vw,28px);font-weight:800;letter-spacing:.3px}
.sub{color:var(--muted);font-size:14px}
.panel{background:var(--panel);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px #0006}
.toolbar{display:flex;flex-wrap:wrap;gap:8px;padding:10px}
button, select{appearance:none;border:none;border-radius:12px;padding:10px 14px;color:#0b1224;background:#e5e7eb;font-weight:700;cursor:pointer;box-shadow:0 2px 0 #cbd5e1}
button:disabled{opacity:.6;cursor:not-allowed}
.btn-ghost{background:#0b1224;color:#e5e7eb;border:1px solid #1f2937;box-shadow:none}
.grid-wrap{display:grid;grid-template-columns: 1fr 380px; gap:16px;}
@media (max-width:980px){.grid-wrap{grid-template-columns:1fr}}
.board{position:relative;padding:16px}
.board-inner{width:100%;--cols:7;--rows:6;display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:6px;background:#1e293b;padding:8px;border-radius:12px;border:1px solid #334155}
.slot{aspect-ratio:1/1;border-radius:50%;background:radial-gradient(circle at 30% 30%,#0ea5e9 0,#334155 55%,#0b1224 100%);display:grid;place-items:center;position:relative;overflow:hidden;transition:box-shadow .3s}
.slot:hover{box-shadow:0 0 20px var(--accent)}
.disc{width:90%;height:90%;border-radius:50%;transform:scale(.1);opacity:0;transition:transform .3s ease, opacity .3s ease, box-shadow .3s ease}
.disc.red{background:radial-gradient(circle at 30% 30%,#fecaca,#ef4444 55%,#7f1d1d 100%);box-shadow:0 6px 16px #ef444455}
.disc.yellow{background:radial-gradient(circle at 30% 30%,#fde68a,#f59e0b 55%,#78350f 100%);box-shadow:0 6px 16px #f59e0b55}
.disc.show{transform:scale(1);opacity:1}
.col-select{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin:10px 0}
.col-btn{padding:8px;border-radius:10px;border:1px dashed #334155;background:#0b1224;color:#cbd5e1;white-space:nowrap;font-size:14px}
.col-btn:hover{border-style:solid}
.col-btn.active{border:2px solid var(--accent);background:#1e293b;color:var(--accent)}
.side{display:flex;flex-direction:column;gap:12px}
.score{display:flex;gap:10px;padding:12px;flex-wrap:wrap}
.badge{padding:6px 10px;border-radius:999px;background:#0b1224;border:1px solid #334155;color:#e5e7eb;font-weight:800;display:flex;align-items:center;gap:6px;font-size:14px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.red{background:var(--red)}
.dot.yellow{background:var(--yellow)}
.turn{padding:12px;color:#a7f3d0;font-weight:700}
.question{padding:14px;border-top:1px solid #1f2937}
.qtext{font-size:18px;font-weight:800;margin-bottom:10px}
.answers{display:grid;grid-template-columns:1fr; gap:8px}
.answer{border:1px solid #334155;background:#0b1224;color:#e5e7eb;border-radius:12px;padding:10px 12px;text-align:left;font-weight:700;cursor:pointer;transition:all .2s}
.answer.correct{border-color:#14532d;background:#052e1a}
.answer.wrong{border-color:#7f1d1d;background:#2b0d0d}
.answer:hover{transform:scale(1.03)}
.toast{position:fixed;inset:auto 0 18px 0;display:flex;justify-content:center;pointer-events:none}
.toast > div{pointer-events:auto;background:#111827ee;border:1px solid #1f2937;color:#e5e7eb;padding:10px 14px;border-radius:12px;box-shadow:0 10px 30px #0006}
.legend{font-size:12px;color:var(--muted);padding:0 12px 12px}
.footer{margin-top:14px;padding:12px;color:var(--muted);text-align:center;font-size:12px}
.hidden{display:none}
@media (max-width:600px){
  .board-inner{gap:4px;padding:4px}
  .col-btn{font-size:12px;padding:6px}
  .qtext{font-size:16px}
}
</style>
</head>
<body>
<div class="app">
<header>
  <div>
    <div class="title">Connect Four ‚Äì German Modal Verbs</div>
    <div class="sub">d√ºrfen ‚Ä¢ k√∂nnen ‚Ä¢ m√∂gen ‚Ä¢ m√ºssen ‚Ä¢ sollen ‚Ä¢ wollen ‚Äî answer correctly to claim a spot</div>
  </div>
  <div class="toolbar panel">
    <button id="newGame" class="btn-ghost" title="Reset the board">‚Üª New Game</button>
  </div>
</header>

<div class="grid-wrap">
<section class="board panel">
  <div class="col-select" id="colSelect"></div>
  <div id="board" class="board-inner"></div>
  <div class="legend">Pick a column. Answer correctly to drop your disc.</div>
</section>

<aside class="side">
  <div class="panel">
    <div class="score">
      <div class="badge"><span class="dot red"></span> Red: <span id="scoreRed">0</span></div>
      <div class="badge"><span class="dot yellow"></span> Yellow: <span id="scoreYellow">0</span></div>
    </div>
    <div id="turn" class="turn">Red to move</div>
    <div class="question">
      <div class="qtext" id="qtext">Pick a column to get a question‚Ä¶</div>
      <div id="answers" class="answers"></div>
    </div>
  </div>
  <div class="panel footer">Built for quick, teacher-directed play. Works offline after installation in supported browsers. ‚ú®</div>
</aside>
</div>
</div>

<div class="toast" id="toast" aria-live="polite"></div>

<script>
// ===============================
// Modal Verb Question Engine
// ===============================

const modalConjugations = [
  {verb:"d√ºrfen", forms:[["ich","darf"],["du","darfst"],["er/sie/es","darf"],["wir","d√ºrfen"],["ihr","d√ºrft"],["sie/Sie","d√ºrfen"]]},
  {verb:"k√∂nnen", forms:[["ich","kann"],["du","kannst"],["er/sie/es","kann"],["wir","k√∂nnen"],["ihr","k√∂nnt"],["sie/Sie","k√∂nnen"]]},
  {verb:"m√∂gen", forms:[["ich","mag"],["du","magst"],["er/sie/es","mag"],["wir","m√∂gen"],["ihr","m√∂gt"],["sie/Sie","m√∂gen"]]},
  {verb:"m√ºssen", forms:[["ich","muss"],["du","musst"],["er/sie/es","muss"],["wir","m√ºssen"],["ihr","m√ºsst"],["sie/Sie","m√ºssen"]]},
  {verb:"sollen", forms:[["ich","soll"],["du","sollst"],["er/sie/es","soll"],["wir","sollen"],["ihr","sollt"],["sie/Sie","sollen"]]},
  {verb:"wollen", forms:[["ich","will"],["du","willst"],["er/sie/es","will"],["wir","wollen"],["ihr","wollt"],["sie/Sie","wollen"]]}
];

const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
function toast(msg, ms=1400){const t=$('#toast');const div=document.createElement('div');div.textContent=msg;t.appendChild(div);setTimeout(()=>div.remove(),ms);}

// Build question bank
const ALL_FORMS = [];
modalConjugations.forEach(v=>{
  v.forms.forEach(([pronoun,form])=>{
    ALL_FORMS.push({verb:v.verb, pronoun, form});
  });
});

const QUESTION_BANK = ALL_FORMS.map(entry=>{
  const wrongPool = ALL_FORMS.map(f=>f.form).filter(f=>f!==entry.form);
  const options = new Set([entry.form]);
  while(options.size<4){
    options.add(wrongPool[Math.floor(Math.random()*wrongPool.length)]);
  }
  return {
    prompt:`${entry.pronoun} ‚Äî ${entry.verb}`,
    options: shuffle([...options]),
    correct: entry.form
  };
});

// ===============================
// Game Variables
// ===============================

const COLS=7, ROWS=6;
let grid, current=1, pendingColumn=null, questionPool=shuffle([...QUESTION_BANK]);

function resetBoard(){
  grid=Array.from({length:ROWS},()=>Array(COLS).fill(0));
  current=1;
  pendingColumn=null;
  questionPool=shuffle([...QUESTION_BANK]);
  renderBoard();
  updateTurn();
  $('#qtext').textContent='Pick a column to get a question‚Ä¶';
  $('#answers').innerHTML='';
}

function renderBoard(){
  const b=$('#board'); b.innerHTML='';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const slot=document.createElement('div'); slot.className='slot';
      const disc=document.createElement('div'); disc.className='disc';
      if(grid[r][c]===1) disc.classList.add('red','show');
      if(grid[r][c]===2) disc.classList.add('yellow','show');
      slot.appendChild(disc); b.appendChild(slot);
    }
  }

  const cs=$('#colSelect'); cs.innerHTML='';
  for(let c=0;c<COLS;c++){
    const btn=document.createElement('button'); btn.className='col-btn';
    btn.textContent=`Col ${c+1}`;
    if(grid[0][c]!==0) btn.disabled=true;
    if(pendingColumn===c) btn.classList.add('active');
    btn.onclick=()=> chooseColumn(c);
    cs.appendChild(btn);
  }
}

function updateTurn(){ $('#turn').textContent=(current===1?'Red':'Yellow')+' to move'; }

function chooseColumn(col){
  pendingColumn=col;
  renderBoard();
  askQuestion();
}

function getNextQuestion(){ 
  if(questionPool.length===0) questionPool=shuffle([...QUESTION_BANK]); 
  return questionPool.pop(); 
}

function askQuestion(){
  if(pendingColumn===null) return;
  const currentQuestion=getNextQuestion();
  $('#qtext').textContent=`Column ${pendingColumn+1}: ${currentQuestion.prompt}`;
  const answers=$('#answers'); answers.innerHTML='';
  const opts=shuffle(currentQuestion.options);
  for(const opt of opts){
    const btn=document.createElement('button');
    btn.className='answer';
    btn.textContent=opt;
    btn.onclick=()=>{
      const ok = (opt===currentQuestion.correct);
      if(!ok){ btn.classList.add('wrong'); }
      finishQuestion(ok);
    };
    answers.appendChild(btn);
  }
}

function finishQuestion(correct){
  if(correct){
    toast('‚úÖ Correct!');
    dropDisc(pendingColumn);
    if(checkWinner(current)){
      toast((current===1?'Red':'Yellow')+' wins! üéâ',5000);
      $('#turn').textContent = (current===1?'Red':'Yellow')+' WINS!';
      disableColumns();
      return;
    }
  } else {
    toast('‚ùå Incorrect ‚Äî turn passes');
  }
  pendingColumn=null;
  $('#answers').innerHTML='';
  $('#qtext').textContent='Pick a column to get a question‚Ä¶';
  current = 3 - current;
  updateTurn();
  renderBoard();
}

function dropDisc(col){
  let row = ROWS-1;
  while(row>=0 && grid[row][col]!==0) row--;
  if(row<0){ pendingColumn=null; return; }
  grid[row][col]=current;
  renderBoard();
  const idx = row*COLS + col;
  const disc = $$('#board .disc')[idx];
  requestAnimationFrame(()=>disc.classList.add('show'));
}

function checkWinner(player){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(grid[r][c]!==player) continue;
      if(c+3<COLS && grid[r][c+1]===player && grid[r][c+2]===player && grid[r][c+3]===player) return true;
      if(r+3<ROWS && grid[r+1][c]===player && grid[r+2][c]===player && grid[r+3][c]===player) return true;
      if(r+3<ROWS && c+3<COLS && grid[r+1][c+1]===player && grid[r+2][c+2]===player && grid[r+3][c+3]===player) return true;
      if(r+3<ROWS && c-3>=0 && grid[r+1][c-1]===player && grid[r+2][c-2]===player && grid[r+3][c-3]===player) return true;
    }
  }
  return false;
}

function disableColumns(){ $$('#colSelect .col-btn').forEach(btn=>btn.disabled=true); }

$('#newGame').onclick=resetBoard;

resetBoard();

// Service Worker registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log('‚úÖ Service Worker registered', reg))
      .catch(err => console.error('‚ùå Service Worker registration failed', err));
  });
}
</script>
</body>
</html>
